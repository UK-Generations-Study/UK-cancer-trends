---
title: "PAF"
author: "Z"
format: 
  html:
    toc: true
    toc-depth: 5
    grid:
      sidebar-width: 200px
      body-width: 2500px
      margin-width: 200px
      gutter-width: 1.5rem
editor: 
  mode: source
project-dir: "."
execute:
  echo: false
  warning: false
  fig-width: 12    
  fig-height: 8  
---

# Population Attributable Fractions (PAF) project

This project is calculating the PAFs over time from 2015 and projecting them in to 2030.

## Literature Review

## Analysis Overview

This project involves the 6 cancer sites that have the top mortality rates in the UK (referencing Positions Paper):

1.  Lung

2.  Colorectal

3.  Pancreatic

4.  Breast

5.  Oesophageal (Split by morphology - squamous cell carcinoma (OSCC) and adenocarcinoma (OAC))

6.  Prostate

The risk factors were included if they met the following criteria:

-   a modifiable risk factor surrounding an individuals lifestyle choices

-   classified as having sufficient evidence for a causal relationship from IARC or World Cancer Research Fund

The final list of risk factors and their exposures that are included in this research project are:

1.  Smoking

    Current Smoking

    Former Smoking

2.  BMI

    Obese(30+ BMI)

    Overweight(25-30 BMI)

3.  Alcohol

    Light (\<12g/day)Drinking

    Medium(12-50g/day)Drinking

    Heavy (\>50g/day) Drinking

4.  Red Meat

    Consuming more than the UK recommended 100g/day

5.  Processed Meat

    Consuming more than the UK recommended 50g/day

6.  Fibre

    Consuming less than the UK recommended 30g/day

### Sources

Risk Factor Data

-   Alcohol, Smoking, BMI: This data were sourced from cleaned data from the positions paper which were originally sourced from the ONS and collected via the [Health Survey England (HSE)](https://digital.nhs.uk/data-and-information/publications/statistical/health-survey-for-england). The data were requested from the [UK Data Service](https://beta.ukdataservice.ac.uk/datacatalogue/studies/study?id=8860) by year.

-   Dietary Data: This data were sourced from the [National Diet and Nutrition Survey](https://www.gov.uk/government/collections/national-diet-and-nutrition-survey) and downloaded from the [UK Data Service](https://beta.ukdataservice.ac.uk/datacatalogue/studies/study?id=6533).

Cancer Incidence Data

-   Data for all cancer incidences were sourced from cleaned data from the positions paper which were originally sourced from Cancer Research UK and Globocan.

-   Additional data on Oesophageal cancer morphology was needed which was sourced from [Offman et al 2018](https://pubmed.ncbi.nlm.nih.gov/29563637/) research on projecting trends in OAC and OSCC.

Risk Ratios

-   Risk ratios were sourced from recent meta-analysis about cancer and the specific risk factors. A list of the sources can be found in Mendeley [here](https://www.mendeley.com/reference-manager/library/collections/90fc0272-7ce4-4e01-a8c3-0c350cb2a74a/all-references/) and tracked in the [PAF Teams folder](https://icracuk.sharepoint.com/:f:/r/sites/DescriptiveEpidemiology/Shared%20Documents/PAF/PAFcalculations/Background%20Literature?csf=1&web=1&e=IboMfc)

## Calculations

The equation used to calculate the PAFS was the same one referenced in the [Brown et al. paper](https://www.nature.com/articles/s41416-018-0029-6) to calculate PAFs with multiple exposure levels:

$$
  PAF = \frac {(p_1 * ERR_1)+(p_2 * ERR_2)+(p_3 * ERR_3)...(p_n * ERR_n)} {1+(p_1 * ERR_1)+(p_2 * ERR_2)+(p_3 * ERR_3)...(p_n * ERR_n)}
  $$ where:

-   pn = population exposure prevalence of risk factor n

-   ERRn = Excess Relative Risk = (RR at exposure level n) - 1

There are many assumptions that are made when calculating PAFs

1.  Causality between the risk factor and the outcome

2.  Accurate measurement of the relative risk and exposure prevalence

3.  Removing the risk factor from the population would remove the risk of the outcome

4.  The exposure is removable from the popualtion

5.  All other risk factors remain constant

### Dietary Risk Factor Calculations

These dietary risk factors do not have clearly defined exposed and unexposed categories.

Instead, categories of consumption were created from the National Diet and Nutrition Survey and RR were broken down to risk per g of increase. Risk at each category was calculated based on risk of consumption at the midpoint of the category.

# Analysis and Results

## Preparing the Data

```{r}
#| echo: false
#| warning: false
library(dplyr)
library(tidyr)
library(stringr)
library (ggplot2)
library(gridExtra)
library(segmented)
```

Running the background code and installing all of the necessary packages

```{r}
#| warning: false
source("C:\\Users\\zrichards.ICR\\OneDrive - The Institute of Cancer Research\\Git\\UK-cancer-trends\\Code\\PAF\\PAFCalculations.R", echo = FALSE)

```

## PAF relationship

Looking at how the PAF change as the population risk factor exposure ranges from 0-100% with different constant relative risks.

```{r}
#| echo: false
#| warning: false
#creating a sequence of prevalence 
prevalencerange <- seq(0, 1, by = 0.01)
# Define a constant Relative Risk (RR)
RRconstantlow <- 1.2 # Example RR constant
RRconstant4 <- 1.5
RRconstantmed <- 5.0
RRconstanthigh <- 10.0 
# Calculate the PAF for each prevalence value
PAFlow <- (prevalencerange * (RRconstantlow-1)) / (1 + (prevalencerange * (RRconstantlow-1)))
PAF4 <- (prevalencerange * (RRconstant4-1)) / (1 + (prevalencerange * (RRconstant4-1)))
PAFmed <- (prevalencerange * (RRconstantmed-1)) / (1 + (prevalencerange * (RRconstantmed-1)))
PAFhigh <- (prevalencerange * (RRconstanthigh-1)) / (1 + (prevalencerange * (RRconstanthigh-1)))
# Plot the PAF against the prevalence
pafplotlow <- ggplot(data.frame(prevalence = prevalencerange, PAF = PAFlow), aes(x = prevalence, y = PAF)) +
  geom_line(color = "blue", size = 1) +
  labs(title = "RR = 1.2",
       x = "RF Prevalence",
       y = "PAF") +
  ylim(0, 1) +
  theme_minimal()
pafplot4 <- ggplot(data.frame(prevalence = prevalencerange, PAF = PAF4), aes(x = prevalence, y = PAF)) +
  geom_line(color = "blue", size = 1) +
  labs(title = "RR = 1.5",
       x = "RF Prevalence",
       y = "PAF") +
  ylim(0, 1) +
  theme_minimal()
pafplotmed <- ggplot(data.frame(prevalence = prevalencerange, PAF = PAFmed), aes(x = prevalence, y = PAF)) +
  geom_line(color = "blue", size = 1) +
  labs(title = "RR = 5.0",
       x = "RF Prevalence",
       y = "PAF") +
  ylim(0, 1) +
  theme_minimal()
pafplothigh<- ggplot(data.frame(prevalence = prevalencerange, PAF = PAFhigh), aes(x = prevalence, y = PAF)) +
  geom_line(color = "blue", size = 1) +
  labs(title = "RR = 10.0",
       x = "RF Prevalence",
       y = "PAF") +
  ylim(0, 1) +
  theme_minimal() 
# Showing the plot
changingpaf <- grid.arrange(pafplotlow, pafplot4, pafplotmed, pafplothigh, ncol=4)

```

## Risk Factor Trends

The risk factors trending over the past 2 decades.:

```{r}
#| echo: false
#| warning: false
cleanedprev <- cleanedprev %>% 
  filter(!variable %in% c("diabetes_men", "diabetes_women", "% Meet Physical Activity Guidelines", "hrt"))

prev_englandwomen <- ggplot(cleanedprev %>% 
  filter (sex == "Women", country == "England"), aes(x = datayear, y = prev, color = variable)) + 
  geom_point() + 
  geom_line() +
  labs(title = "Risk Factors for Women",
       x = "Year",
       y = "Risk Factor Prevalence") +
  theme_minimal()
print(prev_englandwomen)

prev_englandmen <- ggplot(cleanedprev %>% 
  filter (sex == "Men", country == "England"), aes(x = datayear, y = prev, color = variable)) + 
  geom_point() + 
  geom_line() +
  labs(title = "Risk Factors for Men",
       x = "Year",
       y = "Risk Factor Prevalence") +
  theme_minimal()
print(prev_englandmen)

```

### Dietary Risk Factors

Bar graphs of prevalence of different levels of exposure consumption.

```{r}

#print(fibrerisk)
print(fibrebar)

#print(all_processedmeat_visualize)
print(pm_dist)

#print(all_redmeat_visualize)
print(rm_dist)
```

### Alcohol Predictions

The Health Survey England (HSE) only has data through 2011. Data previously, whether from the HSE or from the old UK wide General Household Survey (ended in 2007), is not comparable as they ask the question is phrased in a different way. This results in prevalence of light drinkers in English men in 2005 being 10% less than what is reported in the same population in 2011 in the HSE. This is alarming as the prevalence of light drinkers in English men in the HSE does not vary by more than 3% from 2011-2019.

As a consequence, prevalence of alcohol consumption in men and women in England was project back using the HSE data and logistic regression. The results can be seen below:

```{r, }
alcohol_predictions <- ggplot(data = alcoholall, aes(x = datayear, y = prev, color = variable)) +
  geom_line(size = 1) +
  geom_point() +
  labs(title = "Prevalence of Alcohol Consumption in England",
       x = "Year of Exposure",
       y = "Prevalence",
       color = "Drinking Category") +
  theme_minimal() +
  scale_color_manual(values = c("lightalcohol_men" = "darkolivegreen4", 
                                "medalcohol_men" = "darkorange3", 
                                "heavyalcohol_men" = "slateblue4", 
                                "lightalcohol_women" = "olivedrab1", 
                                "medalcohol_women" = "orange", 
                                "heavyalcohol_women" = "lightslateblue"))
  
print(alcohol_predictions)
```

## Cancer Case Trends

How cancer incidence changes over time. These are absolute cases so they do not account for the ageing population or population growth.

```{r}
#| echo: false
#| warning: false

cancer_colors <- c(
  "Lung" = "#1B9E77",
  "Colorectal" = "chocolate1",
  "Pancreatic" = "#7570B3",
  "Breast" = "#E7298A",
  "Oesophageal" = "#66A61E",
  "Prostate" = "firebrick3",
  "All sites excl. NMSC" = "dodgerblue4"
)

#MEN
cancerratesEM <- cancerrates %>% filter(Country == "England", Sex =="Men", Year <= 2019)

# Create the plot with a separate line and prediction line for each Cancer_Site
cancercases_englandmen <- ggplot(cancerratesEM, aes(x = Year, y = Incidences, color = Cancer_Site)) + 
  geom_point() + 
  geom_line() +
  labs(title = "Cancer Incidences in England by Cancer Site for Men",
       x = "Year",
       y = "Incidence Cases") +
  scale_color_manual(values = cancer_colors) +
  theme_minimal()
print(cancercases_englandmen)


#WOMEN
cancerratesEW <- cancerrates %>% filter(Country == "England", Sex =="Women", Year <= 2019)

# Create the plot with a separate line and prediction line for each Cancer_Site
cancercases_englandwomen <- ggplot(cancerratesEW, aes(x = Year, y = Incidences, color = Cancer_Site)) + 
  geom_point() + 
  geom_line() +
  labs(title = "Cancer Incidences in England by Cancer Site for Women",
       x = "Year",
       y = "Incidence Cases") +
  scale_color_manual(values = cancer_colors) +
  theme_minimal()
print(cancercases_englandwomen)
#print 
#englandcancer <- grid.arrange(cancercases_englandmen, cancercases_englandwomen)

```

## PAF by Cancer Site

How the individual risk factor PAFs trend over time by cancer site:

```{r}
#| echo: false
#| warning: false
############# MEN ###################
smoking <- PAF_all %>% filter(riskfactor == "smoking", sex == "Men")
bmi <- PAF_all %>% filter(riskfactor == "bmi", sex == "Men")
alcohol <- PAF_all %>% filter(riskfactor == "alcohol", sex == "Men")
fibre <- PAF_all %>% filter(riskfactor == "fibre", sex == "Men")
redmeat <- PAF_all %>% filter(riskfactor =="redmeat", sex == "Men")
processedmeat <- PAF_all %>% filter(riskfactor =="processedmeat", sex == "Men")
#run graphs 
#LUNG CANCER
smoking_lungmen <- ggplot(smoking, aes(x= yr, y = Lung)) + 
  geom_line() + geom_point() + 
  labs(title = "Smoking", x = "Year of Exposure of Exposure", y = "PAF") +
  theme_minimal () +  ylim(0,.75) +xlim(2005, 2019)
#COLORECTAL CANCER
smoking_colorectalmen <- ggplot(smoking, aes(x= yr, y = Colorectal)) +
  geom_line() + geom_point() + 
  labs(title = "Smoking", x = "Year of Exposure of Exposure", y = "PAF") + 
  theme_minimal () +  ylim(0,.2) +xlim(2005, 2019)
bmi_colorectalmen <- ggplot(bmi, aes(x= yr, y = Colorectal)) + geom_line() + geom_point() + 
  labs(title = "BMI", x = "Year of Exposure of Exposure", y = "PAF") + 
  theme_minimal () +  ylim(0,.2) +xlim(2005, 2019)
alcohol_colorectalmen <- ggplot(alcohol, aes(x= yr, y = Colorectal)) + 
  geom_line() + geom_point() + 
  labs(title = "Alcohol", x = "Year of Exposure of Exposure", y = "PAF") + 
  theme_minimal () +  ylim(0,.2) +xlim(2005, 2019)
fibre_colorectalmen <- ggplot(fibre, aes( x = yr, y = Colorectal)) + 
  geom_line() + geom_point() + 
  labs(title = "Fibre", x = "Year of Exposure of Exposure", y = "PAF") + 
  theme_minimal () + ylim(0,0.2) +xlim(2005, 2019)
redmeat_colorectalmen <- ggplot(redmeat, aes( x = yr, y = Colorectal)) +
  geom_line() + geom_point() + 
  labs(title = "Red Meat", x = "Year of Exposure of Exposure", y = "PAF") + 
  theme_minimal () + ylim(0,0.2) +xlim(2005, 2019)
processedmeat_colorectalmen <- ggplot(processedmeat, aes( x = yr, y = Colorectal)) + geom_line() + geom_point() + 
  labs(title = "Processed Meat", x = "Year of Exposure of Exposure", y = "PAF") + 
  theme_minimal () + ylim(0,0.2) +xlim(2005, 2019)
#PANCREAS CANCER
smoking_pancreasmen <- ggplot(smoking, aes(x= yr, y = Pancreas)) +
  geom_line() + geom_point() + 
  labs(title = "Smoking", x = "Year of Exposure of Exposure", y = "PAF") +
  theme_minimal () + ylim(0,.3) +xlim(2005, 2019)
bmi_pancreasmen <- ggplot(bmi, aes(x= yr, y = Pancreas)) + 
  geom_line() + geom_point() + 
  labs(title = "BMI", x = "Year of Exposure of Exposure", y = "PAF") +
  theme_minimal () + ylim(0,.3) +xlim(2005, 2019)
#SCC CANCER
smoking_SCCmen <- ggplot(smoking, aes(x= yr, y = SCC)) + 
  geom_line() + geom_point() + 
  labs(title = "Smoking", x = "Year of Exposure of Exposure", y = "PAF") + 
  theme_minimal () + ylim(0,.6) +xlim(2005, 2019)
bmi_SCCmen <- ggplot(bmi, aes(x= yr, y = SCC)) +
  geom_line() + geom_point() + 
  labs(title = "BMI", x = "Year of Exposure of Exposure", y = "PAF") + 
  theme_minimal () + ylim(0,.6) +xlim(2005, 2019)
alcohol_SCCmen <- ggplot(alcohol, aes(x= yr, y = SCC)) + 
  geom_line() + geom_point() + 
  labs(title = "Alcohol", x = "Year of Exposure of Exposure", y = "PAF") + 
  theme_minimal () + ylim(0,.6) +xlim(2005, 2019)
#AC CANCER
smoking_ACmen <- ggplot(smoking, aes(x= yr, y = AC)) + 
  geom_line() + geom_point() +
  labs(title = "Smoking", x = "Year of Exposure of Exposure", y = "PAF") + 
  theme_minimal () + ylim(0,.4) +xlim(2005, 2019)
bmi_ACmen <- ggplot(bmi, aes(x= yr, y = AC)) + 
  geom_line() + geom_point() + 
  labs(title = "BMI", x = "Year of Exposure", y = "PAF") + 
  theme_minimal () + ylim(0,0.4)+xlim(2005, 2019)
alcohol_ACmen <- ggplot(alcohol, aes(x= yr, y = AC)) + 
  geom_line() + geom_point() +
  labs(title = "Alcohol", x = "Year of Exposure", y = "PAF") + 
  theme_minimal () + ylim(0,.4) +xlim(2005, 2019)

############# WOMEN ###################
smoking <- PAF_all %>% filter(riskfactor == "smoking", sex == "Women")
bmi <- PAF_all %>% filter(riskfactor == "bmi", sex == "Women")
alcohol <- PAF_all %>% filter(riskfactor == "alcohol", sex == "Women")
fibre <- PAF_all %>% filter(riskfactor == "fibre", sex == "Women")
redmeat <- PAF_all %>% filter(riskfactor =="redmeat", sex == "Women")
processedmeat <- PAF_all %>% filter(riskfactor =="processedmeat", sex == "Women")
#####################################################
#LUNG CANCER
smoking_lungwomen <- ggplot(smoking, aes(x= yr, y = Lung)) + 
  geom_line() + geom_point() + 
  labs(title = "Smoking", x = "Year of Exposure", y = "PAF") +
  theme_minimal () + ylim(0,.75)+xlim(2005, 2019)
#COLORECTAL CANCER
smoking_colorectalwomen <- ggplot(smoking, aes(x= yr, y = Colorectal)) +
  geom_line() + geom_point() + 
  labs(title = "Smoking", x = "Year of Exposure", y = "PAF") + 
  theme_minimal () + ylim(0,.2) +xlim(2005, 2019)
bmi_colorectalwomen <- ggplot(bmi, aes(x= yr, y = Colorectal)) +
  geom_line() + geom_point() + 
  labs(title = "BMI", x = "Year of Exposure", y = "PAF") + 
  theme_minimal () + ylim(0,.2) +xlim(2005, 2019)
alcohol_colorectalwomen <- ggplot(alcohol, aes(x= yr, y = Colorectal)) +
  geom_line() + geom_point() + 
  labs(title = "Alcohol", x = "Year of Exposure", y = "PAF") + 
  theme_minimal () + ylim(0,.2) +xlim(2005, 2019)
fibre_colorectalwomen <- ggplot(fibre, aes( x = yr, y = Colorectal)) + 
  geom_line() + geom_point() + 
  labs(title = "Fibre", x = "Year of Exposure", y = "PAF") + 
  theme_minimal () + ylim(0,0.2) +xlim(2005, 2019)
redmeat_colorectalwomen <- ggplot(redmeat, aes( x = yr, y = Colorectal)) +
  geom_line() + geom_point() + 
  labs(title = "Red Meat", x = "Year of Exposure", y = "PAF") + 
  theme_minimal () + ylim(0,0.2) +xlim(2005, 2019)
processedmeat_colorectalwomen <- ggplot(processedmeat, aes( x = yr, y = Colorectal)) + 
  geom_line() + geom_point() + 
  labs(title = "Processed Meat", x = "Year of Exposure", y = "PAF") + 
  theme_minimal () + ylim(0,0.2) +xlim(2005, 2019)
#PANCREAS CANCER
smoking_pancreaswomen <- ggplot(smoking, aes(x= yr, y = Pancreas)) + 
  geom_line() + geom_point() + 
  labs(title = "Smoking", x = "Year of Exposure", y = "PAF") +
  theme_minimal () + ylim(0,.3) +xlim(2005, 2019)
bmi_pancreaswomen <- ggplot(bmi, aes(x= yr, y = Pancreas)) +
  geom_line() + geom_point() + 
  labs(title = "BMI ", x = "Year of Exposure", y = "PAF") +
  theme_minimal () + ylim(0,.3) +xlim(2005, 2019)
#BREAST CANCER
bmi_breastwomen <- ggplot(bmi, aes(x= yr, y = Breast)) + 
  geom_line() + geom_point() +
  labs(title = "BMI", x = "Year of Exposure", y = "PAF") +
  theme_minimal () + ylim(0,.1) +xlim(2005, 2019)
alcohol_breastwomen <- ggplot(alcohol, aes(x= yr, y = Breast)) +
  geom_line() + geom_point() +
  labs(title = "Alcohol", x = "Year of Exposure", y = "PAF") +
  theme_minimal () + ylim(0,.1) +xlim(2005, 2019)
#SCC CANCER
smoking_SCCwomen <- ggplot(smoking, aes(x= yr, y = SCC)) + 
  geom_line() + geom_point() + 
  labs(title = "Smoking", x = "Year of Exposure", y = "PAF") + 
  theme_minimal () + ylim(0,.6)+xlim(2005, 2019)
bmi_SCCwomen <- ggplot(bmi, aes(x= yr, y = SCC)) + 
  geom_line() + geom_point() + 
  labs(title = "BMI", x = "Year of Exposure", y = "PAF") + 
  theme_minimal () + ylim(0,.6) +xlim(2005, 2019)
alcohol_SCCwomen <- ggplot(alcohol, aes(x= yr, y = SCC)) + 
  geom_line() + geom_point() + 
  labs(title = "Alcohol", x = "Year of Exposure", y = "PAF") + 
  theme_minimal () + ylim(0,.6) +xlim(2005, 2019)
#AC CANCER
smoking_ACwomen <- ggplot(smoking, aes(x= yr, y = AC)) + 
  geom_line() + geom_point() + 
  labs(title = "Smoking", x = "Year of Exposure", y = "PAF") + 
  theme_minimal () + ylim(0,.4) +xlim(2005, 2019)
bmi_ACwomen <- ggplot(bmi, aes(x= yr, y = AC)) + 
  geom_line() + geom_point() + 
  labs(title = "BMI", x = "Year of Exposure", y = "PAF") + 
  theme_minimal () + ylim(0,0.4)+xlim(2005, 2019)
alcohol_ACwomen <- ggplot(alcohol, aes(x= yr, y = AC)) + 
  geom_line() + geom_point() + 
  labs(title = "Alcohol", x = "Year of Exposure", y = "PAF") + 
  theme_minimal () + ylim(0,.4)+xlim(2005, 2019)

#print the graphs together 
# MEN
Mlungcancer <- arrangeGrob(smoking_lungmen, ncol = 3, top = "MEN")
Mcolorectalcancer <- arrangeGrob(bmi_colorectalmen, fibre_colorectalmen,  smoking_colorectalmen, alcohol_colorectalmen, redmeat_colorectalmen, processedmeat_colorectalmen, ncol = 3, top = "MEN")
Mpancreascancer <- arrangeGrob(smoking_pancreasmen, bmi_pancreasmen, ncol = 3, top = "MEN")
MSCCcancer <- arrangeGrob(smoking_SCCmen, alcohol_SCCmen, bmi_SCCmen, ncol = 3, top = "MEN")
MACcancer <- arrangeGrob(smoking_ACmen, bmi_ACmen, alcohol_ACmen, ncol = 3, top = "MEN")

# WOMEN
Wlungcancer <- arrangeGrob(smoking_lungwomen, ncol = 3, top = "WOMEN")
Wcolorectalcancer <- arrangeGrob(bmi_colorectalwomen, fibre_colorectalwomen, smoking_colorectalwomen, alcohol_colorectalwomen, redmeat_colorectalwomen, processedmeat_colorectalwomen, ncol = 3, top = "WOMEN")
Wpancreascancer <- arrangeGrob(smoking_pancreaswomen, bmi_pancreaswomen, ncol = 3, top = "WOMEN")
Wbreastcancer <- arrangeGrob(bmi_breastwomen, alcohol_breastwomen, ncol = 3, top = "WOMEN Estimates for Population Attributable Fractions on Breast Cancer")
WSCCcancer <- arrangeGrob(smoking_SCCwomen, alcohol_SCCwomen, bmi_SCCwomen, ncol = 3, top = "WOMEN")
WACcancer <- arrangeGrob(smoking_ACwomen, bmi_ACwomen, alcohol_ACwomen, ncol = 3, top = "WOMEN")

# #ALL
# lung <- grid.arrange(Mlungcancer, Wlungcancer, ncol=2, top = "Estimates for Population Attributable Fractions on Lung Cancer")
# colorectal <- grid.arrange(Mcolorectalcancer, Wcolorectalcancer, nrow=2, top = "Estimates for Population Attributable Fractions on Colorectal Cancer" )
# pancreas <- grid.arrange(Mpancreascancer, Wpancreascancer, nrow=2, top = "Estimates for Population Attributable Fractions on Pancreas Cancer")
# Wbreastcancer <- grid.arrange( bmi_breastwomen, alcohol_breastwomen, nrow=2, top = "WOMEN Estimates for Population Attributable Fractions on Breast Cancer")
# SCC <- grid.arrange(MSCCcancer, WSCCcancer, nrow=2, top = "Estimates for Population Attributable Fractions on OSCC Cancer")
# AC <- grid.arrange(MACcancer, WACcancer, nrow=2, top = "Estimates for Population Attributable Fractions on OAC Cancer")

```

### 1. Lung

Estimates for Population Attributable Fractions on Lung Cancer

```{r}
lung <- grid.arrange(Mlungcancer, Wlungcancer, nrow=2, top = "Estimates for Population Attributable Fractions on Lung Cancer")

```

### 2. Colorectal

Estimates for Population Attributable Fractions on Colorectal Cancer

```{r}
colorectal <- grid.arrange(Mcolorectalcancer, nrow = 1)
colorectal1 <- grid.arrange(Wcolorectalcancer, nrow = 1 )


```

### 3. Pancreas

Estimates for Population Attributable Fractions on Pancreas Cancer

```{r}
pancreas <- grid.arrange(Mpancreascancer, Wpancreascancer, nrow=2, top = "Estimates for Population Attributable Fractions on Pancreas Cancer")

```

### 4. Breast

Estimates for Population Attributable Fractions on Breast Cancer

```{r}
Wbreastcancer <- grid.arrange( bmi_breastwomen, alcohol_breastwomen, ncol=3, top = "WOMEN")

```

### 5. Oesophageal SCC

Estimates for Population Attributable Fractions on OSCC Cancer

```{r}
SCC <- grid.arrange(MSCCcancer, WSCCcancer, nrow=2, top = "Estimates for Population Attributable Fractions on OSCC Cancer")

```

### 6. Oesophageal AC

Estimates for Population Attributable Fractions on OAC Cancer

```{r}
AC <- grid.arrange(MACcancer, WACcancer, nrow=2, top = "Estimates for Population Attributable Fractions on OAC Cancer")
```

## PAF by Risk Factor

How the individual risk factor PAFs trend over time grouped by risk factor:

```{r}
#| echo: false
#| warning: false
############# MEN ###################
smoking <- PAF_all %>% filter(riskfactor == "smoking", sex == "Men")
bmi <- PAF_all %>% filter(riskfactor == "bmi", sex == "Men")
alcohol <- PAF_all %>% filter(riskfactor == "alcohol", sex == "Men")
fibre <- PAF_all %>% filter(riskfactor == "fibre", sex == "Men")
redmeat <- PAF_all %>% filter(riskfactor =="redmeat", sex == "Men")
processedmeat <- PAF_all %>% filter(riskfactor =="processedmeat", sex == "Men")
#####################################################
#run graphs 
#LUNG CANCER
smoking_lungmen <- ggplot(smoking, aes(x= yr, y = Lung)) + 
  geom_line() + geom_point() + 
  labs(title = "Lung Cancer", x = "Year of Exposure", y = "PAF") +
  theme_minimal () + ylim(0,.75)+xlim(2005, 2019)
#COLORECTAL CANCER
smoking_colorectalmen <- ggplot(smoking, aes(x= yr, y = Colorectal)) + 
  geom_line() + geom_point() + 
  labs(title = "Colorectal Cancer", x = "Year of Exposure", y = "PAF") + 
  theme_minimal () + ylim(0,.75) +xlim(2005, 2019)
bmi_colorectalmen <- ggplot(bmi, aes(x= yr, y = Colorectal)) + 
  geom_line() + geom_point() + 
  labs(title = "Colorectal Cancer", x = "Year of Exposure", y = "PAF") + 
  theme_minimal () + ylim(0,.4)+xlim(2005, 2019)
alcohol_colorectalmen <- ggplot(alcohol, aes(x= yr, y = Colorectal)) + 
  geom_line() + geom_point() + 
  labs(title = "Colorectal Cancer", x = "Year of Exposure", y = "PAF") + 
  theme_minimal () + ylim(0,.45) +xlim(2005, 2019)
fibre_colorectalmen <- ggplot(fibre, aes( x = yr, y = Colorectal)) + 
  geom_line() + geom_point() + 
  labs(title = "Fibre", x = "Year of Exposure", y = "PAF") + 
  theme_minimal () + ylim(0,0.2) +xlim(2005, 2019)
redmeat_colorectalmen <- ggplot(redmeat, aes( x = yr, y = Colorectal)) + 
  geom_line() + geom_point() + 
  labs(title = "Red Meat", x = "Year of Exposure", y = "PAF") + 
  theme_minimal () + ylim(0,0.2) +xlim(2005, 2019)
processedmeat_colorectalmen <- ggplot(processedmeat, aes( x = yr, y = Colorectal)) + geom_line() + geom_point() + 
  labs(title = "Processed Meat", x = "Year of Exposure", y = "PAF") + 
  theme_minimal () + ylim(0,0.2) +xlim(2005, 2019)
#PANCREAS CANCER
smoking_pancreasmen <- ggplot(smoking, aes(x= yr, y = Pancreas)) + 
  geom_line() + geom_point() + 
  labs(title = "Pancreas Cancer", x = "Year of Exposure", y = "PAF") +
  theme_minimal () + ylim(0,.75) +xlim(2005, 2019)
bmi_pancreasmen <- ggplot(bmi, aes(x= yr, y = Pancreas)) + 
  geom_line() + geom_point() + 
  labs(title = "Pancreas Cancer", x = "Year of Exposure", y = "PAF") +
  theme_minimal () + ylim(0,.4) +xlim(2005, 2019)
#SCC CANCER
smoking_SCCmen <- ggplot(smoking, aes(x= yr, y = SCC)) + 
  geom_line() + geom_point() + 
  labs(title = "OSCC Cancer", x = "Year of Exposure", y = "PAF") + 
  theme_minimal () + ylim(0,.75) +xlim(2005, 2019)
bmi_SCCmen <- ggplot(bmi, aes(x= yr, y = SCC)) + 
  geom_line() + geom_point() + 
  labs(title = "OSCC Cancer", x = "Year of Exposure", y = "PAF") + 
  theme_minimal () + ylim(0,.4) +xlim(2005, 2019)
alcohol_SCCmen <- ggplot(alcohol, aes(x= yr, y = SCC)) + 
  geom_line() + geom_point() + 
  labs(title = "OSCC Cancer", x = "Year of Exposure", y = "PAF") + 
  theme_minimal () + ylim(0,.45) +xlim(2005, 2019)
#AC CANCER
smoking_ACmen <- ggplot(smoking, aes(x= yr, y = AC)) + 
  geom_line() + geom_point() + 
  labs(title = "OAC Cancer", x = "Year of Exposure", y = "PAF") + 
  theme_minimal () + ylim(0,.75) +xlim(2005, 2019)
bmi_ACmen <- ggplot(bmi, aes(x= yr, y = AC)) +
  geom_line() + geom_point() + 
  labs(title = "OAC Cancer", x = "Year of Exposure", y = "PAF") + 
  theme_minimal () + ylim(0,0.4)+xlim(2005, 2019)
alcohol_ACmen <- ggplot(alcohol, aes(x= yr, y = AC)) +
  geom_line() + geom_point() + 
  labs(title = "OAC Cancer", x = "Year of Exposure", y = "PAF") + 
  theme_minimal () + ylim(0,.45) +xlim(2005, 2019)

############# WOMEN ###################
smoking <- PAF_all %>% filter(riskfactor == "smoking", sex == "Women")
bmi <- PAF_all %>% filter(riskfactor == "bmi", sex == "Women")
alcohol <- PAF_all %>% filter(riskfactor == "alcohol", sex == "Women")
fibre <- PAF_all %>% filter(riskfactor == "fibre", sex == "Women")
redmeat <- PAF_all %>% filter(riskfactor =="redmeat", sex == "Women")
processedmeat <- PAF_all %>% filter(riskfactor =="processedmeat", sex == "Women")
#####################################################
#LUNG CANCER
smoking_lungwomen <- ggplot(smoking, aes(x= yr, y = Lung)) + 
  geom_line() + geom_point() + 
  labs(title = "Lung Cancer", x = "Year of Exposure", y = "PAF") +
  theme_minimal () + ylim(0,.75)+xlim(2005, 2019)
#COLORECTAL CANCER
smoking_colorectalwomen <- ggplot(smoking, aes(x= yr, y = Colorectal)) + 
  geom_line() + geom_point() + 
  labs(title = "Colorectal Cancer", x = "Year of Exposure", y = "PAF") + 
  theme_minimal () + ylim(0,.75) +xlim(2005, 2019)
bmi_colorectalwomen <- ggplot(bmi, aes(x= yr, y = Colorectal)) + 
  geom_line() + geom_point() + 
  labs(title = "Colorectal Cancer", x = "Year of Exposure", y = "PAF") + 
  theme_minimal () + ylim(0,.4) +xlim(2005, 2019)
alcohol_colorectalwomen <- ggplot(alcohol, aes(x= yr, y = Colorectal)) +
  geom_line() + geom_point() + 
  labs(title = "Colorectal Cancer", x = "Year of Exposure", y = "PAF") + 
  theme_minimal () + ylim(0,.45) +xlim(2005, 2019)
fibre_colorectalwomen <- ggplot(fibre, aes( x = yr, y = Colorectal)) + 
  geom_line() + geom_point() + 
  labs(title = "Fibre", x = "Year of Exposure", y = "PAF") + 
  theme_minimal () + ylim(0,0.2) +xlim(2005, 2019)
redmeat_colorectalwomen <- ggplot(redmeat, aes( x = yr, y = Colorectal)) + geom_line() + geom_point() + 
  labs(title = "Red Meat", x = "Year of Exposure", y = "PAF") + 
  theme_minimal () + ylim(0,0.2) +xlim(2005, 2019)
processedmeat_colorectalwomen <- ggplot(processedmeat, aes( x = yr, y = Colorectal)) + geom_line() + geom_point() + 
  labs(title = "Processed Meat", x = "Year of Exposure", y = "PAF") + 
  theme_minimal () + ylim(0,0.2) +xlim(2005, 2019)
#PANCREAS CANCER
smoking_pancreaswomen <- ggplot(smoking, aes(x= yr, y = Pancreas)) + 
  geom_line() + geom_point() + 
  labs(title = "Pancreas Cancer", x = "Year of Exposure", y = "PAF") +
  theme_minimal () + ylim(0,.75) +xlim(2005, 2019)
bmi_pancreaswomen <- ggplot(bmi, aes(x= yr, y = Pancreas)) + 
  geom_line() + geom_point() + 
  labs(title = "Pancreas Cancer", x = "Year of Exposure", y = "PAF") +
  theme_minimal () + ylim(0,.4) +xlim(2005, 2019)
#BREAST CANCER
bmi_breastwomen <- ggplot(bmi, aes(x= yr, y = Breast)) + 
  geom_line() + geom_point() +
  labs(title = "Breast Cancer", x = "Year of Exposure", y = "PAF") +
  theme_minimal () + ylim(0,.4) +xlim(2005, 2019)
alcohol_breastwomen <- ggplot(alcohol, aes(x= yr, y = Breast)) +
  geom_line() + geom_point() +
  labs(title = "Breast Cancer", x = "Year of Exposure", y = "PAF") +
  theme_minimal () + ylim(0,.45) +xlim(2005, 2019)
#SCC CANCER
smoking_SCCwomen <- ggplot(smoking, aes(x= yr, y = SCC)) +
  geom_line() + geom_point() + 
  labs(title = "OSCC Cancer", x = "Year of Exposure", y = "PAF") + 
  theme_minimal () + ylim(0,.75)+xlim(2005, 2019)
bmi_SCCwomen <- ggplot(bmi, aes(x= yr, y = SCC)) +
  geom_line() + geom_point() + 
  labs(title = "OSCC Cancer", x = "Year of Exposure", y = "PAF") + 
  theme_minimal () + ylim(0,.4) +xlim(2005, 2019)
alcohol_SCCwomen <- ggplot(alcohol, aes(x= yr, y = SCC)) +
  geom_line() + geom_point() + 
  labs(title = "OSCC Cancer", x = "Year of Exposure", y = "PAF") + 
  theme_minimal () + ylim(0,.45) +xlim(2005, 2019)
#AC CANCER
smoking_ACwomen <- ggplot(smoking, aes(x= yr, y = AC)) + 
  geom_line() + geom_point() + 
  labs(title = "OAC Cancer", x = "Year of Exposure", y = "PAF") + 
  theme_minimal () + ylim(0,.75) +xlim(2005, 2019)
bmi_ACwomen <- ggplot(bmi, aes(x= yr, y = AC)) +
  geom_line() + geom_point() + 
  labs(title = "OAC Cancer", x = "Year of Exposure", y = "PAF") + 
  theme_minimal () + ylim(0,0.4)+xlim(2005, 2019)
alcohol_ACwomen <- ggplot(alcohol, aes(x= yr, y = AC)) + 
  geom_line() + geom_point() + 
  labs(title = "OAC Cancer", x = "Year of Exposure", y = "PAF") + 
  theme_minimal () + ylim(0,.45)+xlim(2005, 2019)

#visualzing 
smokingmen <- arrangeGrob(smoking_lungmen, smoking_SCCmen, smoking_ACmen, smoking_pancreasmen, smoking_colorectalmen, ncol = 3, top = "MEN")
smokingwomen <- arrangeGrob(smoking_lungwomen, smoking_SCCwomen, smoking_ACwomen, smoking_pancreaswomen, smoking_colorectalwomen, ncol = 3, top = "WOMEN")

# smoking_allcancersites <- grid.arrange(smokingmen, smokingwomen, nrow = 2, top = "Smoking as a Cancer Risk Factor")

bmimen <- arrangeGrob(bmi_ACmen, bmi_colorectalmen, bmi_pancreasmen, ncol = 3, top = "MEN")
bmiwomen <- arrangeGrob(bmi_ACwomen, bmi_colorectalwomen, bmi_breastwomen, bmi_pancreaswomen, ncol = 3, top = "WOMEN")

# bmi_allcancersites <- grid.arrange(bmimen, bmiwomen, nrow = 2, top = "BMI as a Cancer Risk Factor")

alcoholmen <- arrangeGrob(alcohol_SCCmen, alcohol_colorectalmen, alcohol_ACmen, ncol = 3, top = "MEN")
alcoholwomen <- arrangeGrob(alcohol_SCCwomen, alcohol_breastwomen, alcohol_colorectalwomen, alcohol_ACwomen, ncol = 3, top = "WOMEN")

# alcohol_allcancersites <- grid.arrange(alcoholmen, alcoholwomen, nrow=2, top = "Alcohol as a Cancer Risk Factor")

dietaryMEN <- arrangeGrob(fibre_colorectalmen, redmeat_colorectalmen, processedmeat_colorectalmen, ncol = 3, top = "MEN")
dietaryWOMEN <- arrangeGrob(fibre_colorectalwomen, redmeat_colorectalwomen, processedmeat_colorectalwomen, ncol = 3, top = "WOMEN")

# dietary <- grid.arrange(dietaryMEN,dietaryWOMEN, nrow = 2,  top = "Dietary Cancer Risk Factors in Colorectal Cancer")

```

### 1.Smoking

Smoking as a Cancer Risk Factor

```{r}
smoking_allcancersites <- grid.arrange(smokingmen, nrow = 1)
smoking_allcancersites1 <- grid.arrange(smokingmen, nrow = 1)
```

### 2.BMI

BMI as a Cancer Risk Factor

```{r}
bmi_allcancersites <- grid.arrange(bmimen, nrow = 2)
bmi_allcancersites1 <- grid.arrange( bmiwomen, nrow = 1)
```

### 3.Alcohol

Alcohol as a Cancer Risk Factor

```{r}
alcohol_allcancersites <- grid.arrange(alcoholmen, nrow=2)
alcohol_allcancersites1 <- grid.arrange(alcoholwomen, nrow=1)
```

### 4.Dietary Factors(Fiber, Processed Meat, Red Meat)

```{r}
dietary <- grid.arrange(dietaryMEN,dietaryWOMEN, nrow = 2,  top = "Dietary Cancer Risk Factors in Colorectal Cancer")
```

## Aggregate PAF

Aggregate PAFs for each cancer site that include the risk factors investigated in this project:

1.  BMI
2.  Smoking
3.  Alcohol
4.  Dietary Factors (Fiber, Processed Meat, Red Meat)

```{r}
#| echo: false
#| warning: false


cancer_colors <- c(
  "Lung" = "#1B9E77",
  "Colorectal" = "#D95F02",
  "Pancreas" = "#7570B3",
  "Breast" = "#E7298A",
  "SCC" = "#66A61E",
  "AC" = "#E6AB02"
)

aggregatepaf_plot_men <- ggplot(aggregate_paf_men, aes(x = Year, y = PAF, color = cancersite, group = cancersite)) +
  geom_line() +
  geom_point() +
  labs(title = "Aggregate PAF for Men (2005-2019)",
       x = "Year of Exposure",
       y = "Cumulative PAF") +
  theme_minimal() +
  ylim(0,.75) +
  scale_x_continuous(breaks = 2005:2019, limits = c(2005, 2019)) +
  scale_color_manual(values = cancer_colors) +
  geom_vline(xintercept = 2015, color = "red", linetype = "dashed", size = 1)  
print(aggregatepaf_plot_men)

aggregatepaf_plot_women <- ggplot(aggregate_paf_women, aes(x = Year, y = PAF, color = cancersite, group = cancersite)) +
  geom_line() +
  geom_point() +
  labs(title = "Aggregate PAF for Women(2005-2019)",
       x = "Year of Exposure",
       y = "Cumulative PAF") +
  theme_minimal() +
  ylim(0,.75) +
  scale_x_continuous(breaks = 2005:2019, limits = c(2005, 2019)) +
  scale_color_manual(values = cancer_colors) +
  geom_vline(xintercept = 2015, color = "red", linetype = "dashed", size = 1)  
print(aggregatepaf_plot_women)

```

### Tables

PAF table for Men

```{r}

format_pafmen <- aggregate_paf_men %>%
  rename(Exposure_Year = Year) %>%
  mutate(PAF_format = PAF * 100, PAF_format = round(ifelse(is.na(PAF_format), 0, PAF_format), 2))

pafmen_table <- format_pafmen %>%
  dplyr::select(Exposure_Year, cancersite, PAF_format) %>%
  pivot_wider(names_from = cancersite, values_from = PAF_format, values_fill = list(PAF_format = 0))

print(pafmen_table)

```

PAF table for women

```{r}

format_pafwomen <- aggregate_paf_women %>%
  rename(Exposure_Year = Year) %>%
  mutate(PAF_format = PAF * 100, PAF_format = round(ifelse(is.na(PAF_format), 0, PAF_format), 2))

pafwomen_table <- format_pafwomen %>%
  dplyr::select(Exposure_Year, cancersite, PAF_format) %>%
  pivot_wider(names_from = cancersite, values_from = PAF_format, values_fill = list(PAF_format = 0))

print(pafwomen_table)
```

Relative change in PAF from 2005-2019 (except for Colorectal which will be from 2008-2018)

```{r}
relativechange <- aggregate_PAF_all %>%
  filter((cancersite == "Colorectal" & Year %in% c(2008, 2018)) | 
         (cancersite != "Colorectal" & Year %in% c(2005, 2019))) %>% 
  pivot_wider(names_from = Year, values_from = PAF, values_fill = list(PAF = 0)) %>%
   mutate(`2005` = ifelse(cancersite == "Colorectal", `2008`, `2005`),
         `2019` = ifelse(cancersite == "Colorectal", `2018`, `2019`)) %>%
  mutate(
    `2005` = `2005` * 100, 
    `2019` = `2019` * 100, 
    PAF_Change = `2019` -`2005`, 
    `2005` = round(ifelse(is.na(`2005`), 0, `2005`), 2), 
    `2019` = round(ifelse(is.na(`2019`), 0, `2019`), 2), 
    PAF_Change = round(ifelse(is.na(PAF_Change), 0, PAF_Change), 2)
    ) %>% 
  dplyr::select(cancersite,sex, `2005`, `2019`, PAF_Change) 
print(relativechange)
```

## Attributable Cases

Using the historical incident cancer cases from the National Cancer Registry and a 10 year time lag between the PAFS and the year that it effects, the attributable cancer cases were calculated.

```{r}
#| echo: false
#| warning: false

cancer_colors <- c(
  "Lung" = "#1B9E77",
  "Colorectal" = "#D95F02",
  "Pancreas" = "#7570B3",
  "Breast" = "#E7298A",
  "SCC" = "#66A61E",
  "AC" = "#E6AB02"
)
# mencases_visualized <- ggplot(mencases, aes(x = Yr_cases, y = attrcases, color = cancersite)) + 
#   geom_point() + 
#   geom_line() +
#   labs(title = "Cases Attributable to Modifiable RF in England for Men",
#        x = "Year",
#        y = "Attributable Cases") +
#   scale_x_continuous(breaks = 2015:2019, limits = c(2015, 2019)) +
#   scale_color_brewer(palette = "Dark2") +
#   theme_minimal() 
# print(mencases_visualized)
# 
# womencases_visualized <- ggplot(womencases, aes(x = Yr_cases, y = attrcases, color = cancersite)) + 
#   geom_point() + 
#   geom_line() +
#   labs(title = "Cases Attributable to Modifiable RF in England for Women",
#        x = "Year",
#        y = "Attributable Cases") +
#   scale_x_continuous(breaks = 2015:2019, limits = c(2015, 2019)) +
#   scale_color_brewer(palette = "Dark2") +
#   theme_minimal() 
# print(womencases_visualized)

mencases_visualized <- ggplot(mencases, aes(x = Yr_cases, y = attrcases, fill = cancersite)) + 
  geom_bar(stat = "identity", position = "dodge") +
  labs(title = "Cases Attributable to Modifiable RF in England for Men",
       x = "Year of Diagnosis",
       y = "Attributable Cases") +
  scale_x_continuous(breaks = 2015:2019, limits = c(2014,2020)) +
  scale_fill_manual(values = cancer_colors) +
  theme_minimal() 
print(mencases_visualized)

womencases_visualized <- ggplot(womencases, aes(x = Yr_cases, y = attrcases, fill = cancersite)) + 
  geom_bar(stat = "identity", position = "dodge") +
  labs(title = "Cases Attributable to Modifiable RF in England for Women",
       x = "Year of Diagnosis",
       y = "Attributable Cases") +
  scale_x_continuous(breaks = 2015:2019, limits = c(2014,2020)) +
  scale_fill_manual(values = cancer_colors) +
  theme_minimal() 
print(womencases_visualized)

```

## Exposure Scenarios

### Complete Smoking Cessation and Lung Cancer

Based in 2019, if all current smokers stopped smoking and no one starts smoking

At the far right of the x-axis, the assumption is:

former smoking prevalence = current smoking prevalence + former smoking prevalence

current smoking prevalence = 0

```{r}
#| echo: false
#| warning: false

source("C:\\Users\\zrichards.ICR\\OneDrive - The Institute of Cancer Research\\Git\\UK-cancer-trends\\Code\\PAF\\ExposureScenarios.R")

mpafformersmoker<- ggplot(data.frame(prevalence = formersmokingrange2019, PAF = smokingprevalence2019$paf), aes(x = prevalence, y = PAF)) +
  geom_line(color = "blue", size = 1) +
  labs(title = "Men",
       x = "Former Smoker Prevalence",
       y = "PAF") +
  ylim(0, 1) +
  xlim(0.2,0.5) +
  theme_minimal() 
wpafformersmoker<- ggplot(data.frame(prevalence = wformersmokingrange2019, PAF = wsmokingprevalence2019$paf), aes(x = prevalence, y = PAF)) +
  geom_line(color = "blue", size = 1) +
  labs(title = "Women",
       x = "Former Smoker Prevalence",
       y = "PAF") +
  ylim(0, 1) +
  xlim(0.2,0.5) +
  theme_minimal() 
smokingcessation <- grid.arrange(mpafformersmoker, wpafformersmoker, ncol = 2, top = "Lung Cancer PAF if all Current Smokers became Former Smokers in England 2019")


```

The conclusion that can be drawn here is that even if it were possible to remove all current smokers from the population by getting them to quit smoking, there would still be a large proportion of lung cancer cases attributable to the longitudinal effects of smoking. This means that the only way to truly remove smoking as a lung cancer risk factor from the population would be for universal smoking cessation and time for those who have ever been cigarette smoking to age out of the population.

### Alcohol Limiting and OSCC Cancer

Based on 2019, if all drinkers in England started limiting their alcohol consumption to light alcohol consumption.

OSCC cancer was chosen because it is the cancer site with the highest RR so the effect would be the most dramatic. This is the cancer site that would be the most affected by changes in alcohol consumption prevalence.

Light alcohol consumption is classified as 1.5 units of alcohol per day which is about one drink. This definition is about what the UK guidelines recommend as healthy alcohol habits ( 14 units per week). That means that this scenario is if all drinkers in England 2019 decided to listen to government health interventions and drink appropriately.

```{r}
mpafalc<- ggplot(data.frame(prevalence = mlightalc_range, PAF = malcprev$paf), aes(x = prevalence, y = PAF)) +
  geom_line(color = "blue", size = 1) +
  labs(title = "Men",
       x = "Light Drinking Prevalence",
       y = "PAF") +
  ylim(0, .5) +
  xlim(.45,.9) +
  theme_minimal() 
wpafalc<- ggplot(data.frame(prevalence = wlightalc_range, PAF = walcprev$paf), aes(x = prevalence, y = PAF)) +
  geom_line(color = "blue", size = 1) +
  labs(title = "Women",
       x = "Light Drinking Prevalence",
       y = "PAF") +
  ylim(0, .5) +
  xlim(.45,.9) +
  theme_minimal()
alcohol_alllight <- grid.arrange(mpafalc, wpafalc, ncol=2, top= "OSCC PAF if all Medium and Heavy Drinkers became Light Drinkers in England 2019")

```

The assumptions behind this scenario are that all drinkers in England 2019 continue drinking but limit their consumption and there are no new drinkers entering the "exposed" population.

### BMI Overweight No Obese and OAC Cancer 

In this scenario, all obese people in 2019 have moved in to the overweight BMI category. OAC was chosen for the same reasons as OSCC cancer was chosen for Alcohol. The scenario is also the same set of assumptions -the whole England population moves to the lowest risk group.

```{r}
mpaf_bmi<- ggplot(data.frame(prevalence = moverweightrange2019, PAF = mbmiprev2019$paf), aes(x = prevalence, y = PAF)) +
  geom_line(color = "blue", size = 1) +
  labs(title = "Men",
       x = "Overweight Prevalence",
       y = "PAF") +
  ylim(0, .5) +
  xlim(0.3,.7) +
  theme_minimal()
wpaf_bmi<- ggplot(data.frame(prevalence = woverweightrange2019, PAF = wbmiprev2019$paf), aes(x = prevalence, y = PAF)) +
  geom_line(color = "blue", size = 1) +
  labs(title = "Women",
       x = "Overweight Prevalence",
       y = "PAF") +
  ylim(0, .5) +
  xlim(0.3,.7) +
  theme_minimal()
bmi_paf <- grid.arrange(mpaf_bmi,wpaf_bmi, ncol = 2, top = "OAC PAF if all People with Obesity became Overweight in England 2019" )
```

The assumptions behind this scenario are that all people in the BMI "risk" category (overweight/obesity) stay in the category and there are no people entering this risk group.

# Relevant for Conclusion

## Literature Comparisons

### Fibre

One of the biggest discrepancies between current PAF literature and this analysis is the RR for fibre. The RR used in this analysis is 0.91(0.87, 1.00) per 10g increment of fibre per day and is sourced from a meta-analysis from the \[WCRF\](Wholegrains, vegetables and fruit and the risk of cancer (wcrf.org).The RR can be transformed to be an ERR per 1g/day by:\
$$
per 1 g deficit  = ln(\frac1{0.93}) = \frac {0.073}{10g} / 10 = \frac {0.007}{1g}
$$ The methodology is described in [Brown et al.](https://pubmed.ncbi.nlm.nih.gov/29567982/). The problem is that the reported RR per 1g of fibre deficit in the methodology is 0.03 per 1g deficit which is significantly larger than the one used in this analysis.

This number is sourced from this [Parkin, 2011 paper](https://www.ncbi.nlm.nih.gov/pmc/articles/PMC3252068/). In this paper, it is acknowledged that the WCRF published a similar number to 0.93; however, it uses a RR of 0.84 per 6g from [Dahm, 2010](https://www.ncbi.nlm.nih.gov/pmc/articles/PMC3252068/)which resulted in the reported 3% per 1g increase in risk that is used in the Parkin paper: $$
per 1 g deficit = ln(\frac1{0.84}) = \frac {0.174}{6g} / 6 = \frac {0.029}{1g}
$$

This number has been widely used throughout literature - [Goon, 2021](https://www.ncbi.nlm.nih.gov/pmc/articles/PMC11064977/) - and drastically overestimates the PAF for fibre and colorectal cancer.

## Predictions in the wake of Covid-19 Pandemic

Looking at the Health Survey England 2022 results to look at how the population prevalence of the main risk factors - alcohol, smoking, BMI - was effected by Covid-19. The HSE survey did not go ahead in 2020 but continued in 2021 and 2022.

1.  Smoking: In 2022, the self reported prevalence of current smokers drops by 5% in both male and female adults when compared to 2019 prevalence.

2.  Alcohol: In 2022,the self reported prevalence of alcohol consumption at all levels is relatively the same when compared to 2019 prevalence.

3.  BMI: In 2022, the self reported prevalence of obesity and overweight is relatively the same when compared to 2019 prevalence (within 2%).

## Limitations

The Brown et al. paper lists limitations for PAF calculations that should be considered. These are relevant for these calculations as well:

-   Bias PAF estimates to be an underestimation of true population measures because:

    -   PAFs are based on the best available data so limitations of the source data should be considered

        ```         
          - Risk factor data is prone to self reporting errors (underestimate) 
        ```

    -   IARC classified sufficient/convincing causal link for risk factor inclusion criteria as there may be inclusion-worthy risk factors that haven’t reached this level

    -   Confounding cannot be ruled out through quality of relative risk evidence. (Example given unexposed group in alcohol RR could include ex and occasional drinkers which would dilute the measure.

    -   The method of summing individual PAFs to reach an overall number inherently underestimates the number because it doesn’t take the effect of risk factors in combination

-   Blanket 10-year latency between PAF and incidence cases because the risk factor prevalence data does not have high quality historical data to have a 30-year latency

    -   Using custom time lag for each cancer site and risk factor would be unsystematic and reduced comparability
